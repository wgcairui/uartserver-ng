# 24 å°æ—¶ç¨³å®šæ€§æµ‹è¯•æŒ‡å—

> å¯åŠ¨æ—¶é—´ï¼š2025-12-19 12:27
> é¢„è®¡å®Œæˆï¼š2025-12-20 12:27

---

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

### ç›®æ ‡

éªŒè¯ UART Server NG åœ¨é•¿æ—¶é—´è¿è¡Œä¸‹çš„ç¨³å®šæ€§ï¼ŒåŒ…æ‹¬ï¼š
- âœ… ç³»ç»Ÿæ— å´©æºƒè¿è¡Œ 24 å°æ—¶
- âœ… å†…å­˜ä½¿ç”¨ç¨³å®šï¼ˆæ— æ³„æ¼ï¼‰
- âœ… æŸ¥è¯¢æˆåŠŸç‡ > 95%
- âœ… æ€§èƒ½æŒ‡æ ‡æ— æ˜æ˜¾è¡°å‡

### æµ‹è¯•é…ç½®

| å‚æ•° | å€¼ |
|------|-----|
| æµ‹è¯•æ—¶é•¿ | 24 å°æ—¶ |
| æ¨¡æ‹Ÿç»ˆç«¯æ•° | 50 ä¸ª |
| æ¨¡æ‹Ÿç”¨æˆ·æ•° | 10 ä¸ª |
| æŸ¥è¯¢é—´éš” | 5 ç§’/ç»ˆç«¯ |
| é¢„æœŸæ€»æŸ¥è¯¢æ•° | ~864,000 æ¬¡ |
| æŒ‡æ ‡æ”¶é›†é—´éš” | 5 åˆ†é’Ÿ |

---

## ğŸš€ å¯åŠ¨æµ‹è¯•

### å‰ç½®å‡†å¤‡

1. **ç¡®ä¿ç›‘æ§ç³»ç»Ÿè¿è¡Œ**:
   ```bash
   cd /Users/cairui/Code/uartserver-ng
   docker-compose -f docker-compose.monitoring.yml up -d
   ```

2. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**:
   ```bash
   docker-compose -f docker-compose.monitoring.yml ps
   ```

   æ‰€æœ‰æœåŠ¡åº”æ˜¾ç¤º "Up (healthy)"

### å¯åŠ¨æµ‹è¯•

```bash
# åœ¨åå°è¿è¡Œæµ‹è¯•
nohup bun run test/stability/24h-endurance-test.ts > logs/stability-test.nohup.log 2>&1 &

# æˆ–ä½¿ç”¨ screen/tmux
screen -S stability-test
bun run test/stability/24h-endurance-test.ts
# Ctrl+A, D åˆ†ç¦» screen
```

### éªŒè¯æµ‹è¯•å·²å¯åŠ¨

```bash
# æŸ¥çœ‹æ—¥å¿—
tail -f logs/stability-test.log

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep "24h-endurance-test"
```

---

## ğŸ“Š ç›‘æ§æµ‹è¯•è¿›åº¦

### 1. å®æ—¶æ—¥å¿—ç›‘æ§

```bash
# æŸ¥çœ‹æµ‹è¯•æ—¥å¿—
tail -f logs/stability-test.log

# æŸ¥çœ‹æœ€è¿‘ 50 è¡Œ
tail -50 logs/stability-test.log
```

### 2. Grafana å¯è§†åŒ–ç›‘æ§

è®¿é—® http://localhost:3000

**æ¨èç›‘æ§é¢æ¿**:
- **ç³»ç»Ÿæ€»è§ˆ** - å®æ—¶è¿æ¥æ•°ã€æŸ¥è¯¢æˆåŠŸç‡
- **Socket.IO è¯¦ç»†ç›‘æ§** - æŸ¥è¯¢å»¶è¿Ÿã€é”™è¯¯ç‡
- **æ•°æ®åº“è¯¦ç»†ç›‘æ§** - è¿æ¥æ± ã€æ“ä½œå»¶è¿Ÿ

### 3. Prometheus æŒ‡æ ‡æŸ¥è¯¢

è®¿é—® http://localhost:9090

**å…³é”®æŸ¥è¯¢**:

```promql
# å†…å­˜ä½¿ç”¨è¶‹åŠ¿
process_resident_memory_bytes

# æŸ¥è¯¢æˆåŠŸç‡ï¼ˆ5åˆ†é’Ÿæ»šåŠ¨çª—å£ï¼‰
sum(rate(uartserver_socketio_queries_total{status="success"}[5m]))
/
sum(rate(uartserver_socketio_queries_total[5m]))

# æŸ¥è¯¢å»¶è¿Ÿ P95
histogram_quantile(0.95,
  sum(rate(uartserver_socketio_query_duration_seconds_bucket[5m])) by (le)
)

# æ´»è·ƒè¿æ¥æ•°
uartserver_socketio_connections_active

# é”™è¯¯ç‡
sum(rate(uartserver_socketio_queries_total{status="error"}[5m]))
```

### 4. ç³»ç»Ÿèµ„æºç›‘æ§

```bash
# CPU å’Œå†…å­˜ä½¿ç”¨
top -pid $(pgrep -f "24h-endurance-test")

# æˆ–ä½¿ç”¨ htop
htop -p $(pgrep -f "24h-endurance-test")
```

---

## ğŸ” å…³é”®ç›‘æ§æŒ‡æ ‡

### å¿…é¡»ç›‘æ§çš„æŒ‡æ ‡

| æŒ‡æ ‡ | æ­£å¸¸èŒƒå›´ | å‘Šè­¦é˜ˆå€¼ | æ£€æŸ¥é¢‘ç‡ |
|------|---------|---------|---------|
| å†…å­˜ä½¿ç”¨ | < 500MB | > 1GB | æ¯å°æ—¶ |
| æŸ¥è¯¢æˆåŠŸç‡ | > 95% | < 90% | æ¯å°æ—¶ |
| æŸ¥è¯¢å»¶è¿Ÿ P95 | < 500ms | > 1000ms | æ¯å°æ—¶ |
| é”™è¯¯ç‡ | < 5% | > 10% | æ¯å°æ—¶ |
| è¿æ¥æ•° | 50-60 | < 40 æˆ– > 100 | æ¯ 2 å°æ—¶ |

### å†…å­˜æ³„æ¼æ£€æµ‹

**æ£€æŸ¥æ–¹æ³•**:

1. **æŸ¥çœ‹å†…å­˜è¶‹åŠ¿å›¾**ï¼ˆGrafanaï¼‰:
   - æ­£å¸¸ï¼šå†…å­˜ä½¿ç”¨ç¨³å®šæˆ–ç•¥å¾®æ³¢åŠ¨
   - å¼‚å¸¸ï¼šæŒç»­ä¸Šå‡ï¼Œæ— ä¸‹é™è¶‹åŠ¿

2. **å¯¹æ¯”åˆå§‹å’Œå½“å‰å†…å­˜**:
   ```bash
   # æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Šä¸­çš„å†…å­˜å¯¹æ¯”
   cat logs/stability-test-report.json | jq '.memory'
   ```

3. **æ£€æŸ¥å †ä½¿ç”¨ç‡**:
   ```promql
   # Prometheus æŸ¥è¯¢
   process_resident_memory_bytes / 1024 / 1024
   ```

**åˆ¤æ–­æ ‡å‡†**:
- âœ… æ­£å¸¸ï¼š24 å°æ—¶å†…å­˜å¢é•¿ < 20%
- âš ï¸ å¯ç–‘ï¼šå†…å­˜å¢é•¿ 20-50%
- âŒ æ³„æ¼ï¼šå†…å­˜å¢é•¿ > 50% ä¸”æŒç»­ä¸Šå‡

---

## â° å®šæœŸæ£€æŸ¥è®¡åˆ’

### æ¯ 2 å°æ—¶æ£€æŸ¥ï¼ˆå»ºè®®ï¼‰

```bash
# 1. æŸ¥çœ‹æµ‹è¯•è¿›åº¦
tail -20 logs/stability-test.log

# 2. æ£€æŸ¥å…³é”®æŒ‡æ ‡
# è®¿é—® Grafana æŸ¥çœ‹ä»ªè¡¨æ¿

# 3. è®°å½•æ£€æŸ¥ç»“æœï¼ˆå¯é€‰ï¼‰
echo "$(date): å†…å­˜ XXX MB, æˆåŠŸç‡ XX%, æŸ¥è¯¢ XXXXX æ¬¡" >> logs/stability-check.log
```

### æ£€æŸ¥æ¸…å•

- [ ] æµ‹è¯•è¿›ç¨‹æ­£åœ¨è¿è¡Œ
- [ ] æ—¥å¿—æ— ä¸¥é‡é”™è¯¯
- [ ] å†…å­˜ä½¿ç”¨åœ¨æ­£å¸¸èŒƒå›´
- [ ] æŸ¥è¯¢æˆåŠŸç‡ > 95%
- [ ] æŸ¥è¯¢å»¶è¿Ÿç¨³å®š
- [ ] è¿æ¥æ•°æ­£å¸¸

---

## ğŸ›‘ åœæ­¢æµ‹è¯•

### æ­£å¸¸åœæ­¢ï¼ˆæµ‹è¯•å®Œæˆåï¼‰

æµ‹è¯•ä¼šåœ¨ 24 å°æ—¶åè‡ªåŠ¨åœæ­¢å¹¶ç”ŸæˆæŠ¥å‘Šã€‚

### æå‰åœæ­¢ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# æ–¹æ³• 1: å‘é€ä¸­æ–­ä¿¡å·
pkill -INT -f "24h-endurance-test"

# æ–¹æ³• 2: å¦‚æœä½¿ç”¨ screen
screen -r stability-test
# Ctrl+C

# æ–¹æ³• 3: æŸ¥æ‰¾è¿›ç¨‹å¹¶ç»ˆæ­¢
ps aux | grep "24h-endurance-test"
kill -INT <PID>
```

**æ³¨æ„**: ä½¿ç”¨ `Ctrl+C` æˆ– `kill -INT` ä¼šè§¦å‘æµ‹è¯•çš„æ¸…ç†æµç¨‹å¹¶ç”ŸæˆæŠ¥å‘Šã€‚

---

## ğŸ“ æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š

### æµ‹è¯•å®Œæˆå

```bash
# 1. æŸ¥çœ‹å®Œæ•´æŠ¥å‘Šï¼ˆJSON æ ¼å¼ï¼‰
cat logs/stability-test-report.json

# 2. æŸ¥çœ‹æŠ¥å‘Šæ‘˜è¦
cat logs/stability-test-report.json | jq '.summary'

# 3. æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
cat logs/stability-test-report.json | jq '.memory'

# 4. æŸ¥çœ‹é”™è¯¯åˆ—è¡¨
cat logs/stability-test-report.json | jq '.errors'
```

### æŠ¥å‘Šå†…å®¹

æŠ¥å‘ŠåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
- **æµ‹è¯•é…ç½®**: ç»ˆç«¯æ•°ã€ç”¨æˆ·æ•°ã€æŸ¥è¯¢é—´éš”ç­‰
- **è¿è¡Œæ—¶é—´**: å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ã€æ€»æ—¶é•¿
- **æŸ¥è¯¢ç»Ÿè®¡**: æ€»æŸ¥è¯¢æ•°ã€æˆåŠŸç‡ã€QPS
- **å†…å­˜ä½¿ç”¨**: åˆå§‹ã€æœ€ç»ˆã€å³°å€¼å†…å­˜
- **é”™è¯¯åˆ—è¡¨**: æ‰€æœ‰æ•è·çš„é”™è¯¯
- **æŒ‡æ ‡å†å²**: æ¯ 5 åˆ†é’Ÿçš„æ€§èƒ½å¿«ç…§

---

## âš ï¸ æ•…éšœæ’æŸ¥

### æµ‹è¯•æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**: æµ‹è¯•è„šæœ¬å¯åŠ¨åç«‹å³é€€å‡º

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥æ—¥å¿—: `cat logs/stability-test.log`
2. æ£€æŸ¥ç«¯å£å ç”¨: `lsof -i :9010`
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥: `mongosh mongodb://localhost:27017`

### å†…å­˜ä½¿ç”¨å¼‚å¸¸å¢é•¿

**ç—‡çŠ¶**: å†…å­˜ä½¿ç”¨æŒç»­ä¸Šå‡è¶…è¿‡ 1GB

**æ’æŸ¥æ­¥éª¤**:
1. ç«‹å³åœæ­¢æµ‹è¯•: `pkill -INT -f "24h-endurance-test"`
2. æŸ¥çœ‹æŠ¥å‘Š: `cat logs/stability-test-report.json | jq '.memory'`
3. æ£€æŸ¥ Prometheus å†…å­˜æŒ‡æ ‡è¶‹åŠ¿å›¾
4. åˆ†æå¯èƒ½çš„å†…å­˜æ³„æ¼ç‚¹

### æŸ¥è¯¢æˆåŠŸç‡ä¸‹é™

**ç—‡çŠ¶**: æˆåŠŸç‡ä½äº 90%

**æ’æŸ¥æ­¥éª¤**:
1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—: `grep ERROR logs/stability-test.log`
2. æ£€æŸ¥åº”ç”¨æ—¥å¿—: `docker logs uartserver-ng`ï¼ˆå¦‚æœä½¿ç”¨ Dockerï¼‰
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥çŠ¶æ€
4. æ£€æŸ¥ç½‘ç»œè¿æ¥

### æµ‹è¯•è¿›ç¨‹æ„å¤–ç»ˆæ­¢

**ç—‡çŠ¶**: æµ‹è¯•è¿›ç¨‹ä¸åœ¨è¿è¡Œ

**æ’æŸ¥æ­¥éª¤**:
1. æŸ¥çœ‹ nohup æ—¥å¿—: `cat logs/stability-test.nohup.log`
2. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—: `dmesg | tail -50`
3. æ£€æŸ¥æ˜¯å¦å†…å­˜ä¸è¶³ï¼ˆOOMï¼‰
4. é‡æ–°å¯åŠ¨æµ‹è¯•

---

## ğŸ“‹ æµ‹è¯•å®Œæˆåæ£€æŸ¥æ¸…å•

æµ‹è¯•å®Œæˆåï¼ŒéªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

- [ ] æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: `logs/stability-test-report.json`
- [ ] æŸ¥çœ‹æŠ¥å‘Šæ‘˜è¦ï¼ŒéªŒè¯æˆåŠŸç‡ > 95%
- [ ] æ£€æŸ¥å†…å­˜ä½¿ç”¨ï¼Œç¡®è®¤æ— æ³„æ¼ï¼ˆå¢é•¿ < 20%ï¼‰
- [ ] æŸ¥çœ‹é”™è¯¯åˆ—è¡¨ï¼Œåˆ†æä¸¥é‡é”™è¯¯
- [ ] æˆªå›¾ Grafana å…³é”®æŒ‡æ ‡å›¾è¡¨
- [ ] æ›´æ–° `NEXT_STEPS.md`ï¼Œæ ‡è®°ç¨³å®šæ€§æµ‹è¯•ä¸ºå®Œæˆ
- [ ] åˆ›å»ºæµ‹è¯•æ€»ç»“æŠ¥å‘Šï¼ˆå¯é€‰ï¼‰
- [ ] æäº¤æµ‹è¯•ç»“æœåˆ° gitï¼ˆå¯é€‰ï¼‰

---

## ğŸ¯ éªŒæ”¶æ ‡å‡†

æµ‹è¯•é€šè¿‡éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| è¿è¡Œæ—¶é•¿ | 24 å°æ—¶ | _å¾…å¡«å†™_ | â³ |
| æ€»æŸ¥è¯¢æ•° | ~864,000 | _å¾…å¡«å†™_ | â³ |
| æŸ¥è¯¢æˆåŠŸç‡ | > 95% | _å¾…å¡«å†™_ | â³ |
| å†…å­˜å¢é•¿ | < 20% | _å¾…å¡«å†™_ | â³ |
| ç³»ç»Ÿå´©æºƒ | 0 æ¬¡ | _å¾…å¡«å†™_ | â³ |
| ä¸¥é‡é”™è¯¯ | 0 ä¸ª | _å¾…å¡«å†™_ | â³ |

---

## ğŸ“ ç´§æ€¥è”ç³»

å¦‚æœæµ‹è¯•è¿‡ç¨‹ä¸­å‡ºç°ä¸¥é‡é—®é¢˜ï¼š

1. **ç«‹å³åœæ­¢æµ‹è¯•**: `pkill -INT -f "24h-endurance-test"`
2. **ä¿å­˜æ—¥å¿—å’ŒæŠ¥å‘Š**: å¤åˆ¶ `logs/` ç›®å½•
3. **æˆªå›¾ Grafana æŒ‡æ ‡**
4. **è®°å½•é—®é¢˜è¯¦æƒ…**
5. **è”ç³»å¼€å‘å›¢é˜Ÿ**

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [NEXT_STEPS.md](./NEXT_STEPS.md) - é¡¹ç›®ä¸‹ä¸€æ­¥è®¡åˆ’
- [Phase 2.10 çŠ¶æ€æŠ¥å‘Š](./PHASE_2.10_STATUS_REPORT.md)
- [æ€§èƒ½æµ‹è¯•æŠ¥å‘Š](./performance-test-report.md)
- [ç›‘æ§ç³»ç»Ÿå®æ–½è®¡åˆ’](./MONITORING_IMPLEMENTATION.md)

---

**æµ‹è¯•è´Ÿè´£äºº**: _å¾…å¡«å†™_
**å¼€å§‹æ—¶é—´**: 2025-12-19 11:35
**é¢„è®¡ç»“æŸ**: 2025-12-20 11:35
**æ–‡æ¡£æ›´æ–°**: 2025-12-19
